<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ course }} Historical Data - BED</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #20c997;
      --primary-dark: #198754;
      --secondary: #4e73df;
      --secondary-dark: #224abe;
      --light-bg: #f8f9fc;
      --dark-text: #2e3a59;
      --mid-text: #5a5c69;
      --light-text: #858796;
      --card-shadow: 0 0.5rem 1.5rem rgba(58, 59, 69, 0.2);
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--light-bg);
      min-height: 100vh;
      padding: 2rem 0;
      position: relative;
      color: var(--mid-text);
    }
    
    body::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(circle at 5% 10%, rgba(78, 115, 223, 0.05) 0%, transparent 20%),
        radial-gradient(circle at 95% 10%, rgba(28, 200, 138, 0.05) 0%, transparent 20%);
      z-index: -1;
    }
    
    .dashboard-header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 2.5rem 0;
      margin-bottom: 2rem;
      border-radius: 0 0 20px 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    
    .stat-card {
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      transition: var(--transition);
      background: white;
      border: none;
      margin-bottom: 1.5rem;
      overflow: hidden;
      position: relative;
    }
    
    .stat-card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 6px;
      background: linear-gradient(to right, var(--primary), var(--secondary));
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 1rem 3rem rgba(58, 59, 69, 0.25);
    }
    
    .card-title {
      color: var(--primary);
      font-weight: 700;
      margin-bottom: 1rem;
      font-size: 1.3rem;
    }
    
    .stat-number {
      font-size: 2.2rem;
      font-weight: 800;
      color: var(--dark-text);
      margin: 0.5rem 0;
    }
    
    .chart-container {
      position: relative;
      height: 400px;
      margin-bottom: 2rem;
      background: white;
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      padding: 1.5rem;
      transition: var(--transition);
    }
    
    .chart-container:hover {
      transform: translateY(-3px);
      box-shadow: 0 0.75rem 2.5rem rgba(58, 59, 69, 0.15);
    }
    
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    
    .chart-title {
      color: var(--primary);
      font-weight: 700;
      margin: 0;
      font-size: 1.3rem;
      display: flex;
      align-items: center;
    }
    
    .chart-title i {
      margin-right: 10px;
      font-size: 1.5rem;
    }
    
    .btn-primary {
      background: linear-gradient(to right, var(--primary), var(--primary-dark));
      border: none;
      border-radius: 12px;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      transition: var(--transition);
      box-shadow: 0 4px 15px rgba(32, 201, 151, 0.2);
    }
    
    .btn-primary:hover {
      background: linear-gradient(to right, var(--primary-dark), #0f7350);
      transform: translateY(-2px);
      box-shadow: 0 7px 20px rgba(32, 201, 151, 0.3);
    }
    
    .btn-outline-primary {
      border: 2px solid var(--primary);
      color: var(--primary);
      border-radius: 12px;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      transition: var(--transition);
    }
    
    .btn-outline-primary:hover {
      background: var(--primary);
      color: white;
      transform: translateY(-2px);
    }
    
    .download-btn {
      background: transparent;
      color: var(--primary);
      border: 2px solid var(--primary);
      padding: 0.5rem 1rem;
      border-radius: 10px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .download-btn:hover {
      background: var(--primary);
      color: white;
      transform: translateY(-2px);
    }
    
    .year-level-card {
      background: white;
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      border-left: 6px solid var(--primary);
      box-shadow: var(--card-shadow);
      transition: var(--transition);
      text-align: center;
    }
    
    .year-level-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 0.75rem 2.5rem rgba(58, 59, 69, 0.15);
    }
    
    .bed-badge {
      background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
      color: white;
      padding: 0.4rem 1rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 700;
      margin-left: 0.5rem;
      box-shadow: 0 2px 8px rgba(78, 115, 223, 0.3);
    }
    
    .selected-data {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: var(--card-shadow);
      border-top: 6px solid var(--primary);
    }
    
    .data-highlight {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 2rem;
      border-radius: 16px;
      text-align: center;
      margin: 2rem 0;
      box-shadow: 0 8px 25px rgba(32, 201, 151, 0.3);
    }
    
    .table th {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      border: none;
      padding: 1rem;
      font-weight: 600;
    }
    
    .table td {
      border-color: #e9ecef;
      padding: 1rem;
    }
    
    .alert-success {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      background: linear-gradient(to right, var(--secondary), var(--secondary-dark));
      color: white;
      border: none;
    }

    .first-year-emphasis {
      background: linear-gradient(135deg, #2a9d8f, #21867a);
      color: white;
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1.5rem 0;
      text-align: center;
      box-shadow: 0 6px 20px rgba(42, 157, 143, 0.3);
    }
    
    .year-level-emphasis {
      border-left: 6px solid var(--primary) !important;
      background: linear-gradient(to right, rgba(32, 201, 151, 0.05), rgba(32, 201, 151, 0.1)) !important;
      transform: scale(1.05);
    }
    
    .emphasis-glow {
      box-shadow: 0 0 20px rgba(32, 201, 151, 0.3) !important;
    }
    
    @media (max-width: 768px) {
      .chart-container {
        height: 300px;
      }
      
      .stat-number {
        font-size: 1.8rem;
      }
      
      .dashboard-header {
        padding: 1.5rem 0;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="dashboard-header">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 class="h3 mb-2">Historical FIRST-YEAR Enrollment Data <span class="bed-badge">BED</span></h1>
          <p class="mb-1">{{ course }} • {{ year }} • {{ semester }} Semester</p>
          <p class="mb-0 opacity-90">Business Education Department - First-Year Historical Records</p>
        </div>
        <div class="col-md-4 text-md-end mt-3 mt-md-0">
          <a href="{{ url_for('index') }}" class="btn btn-light">
            <i class='bx bx-home'></i> Home
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
          {% for msg in messages %}
            <p class="mb-0">{{ msg }}</p>
          {% endfor %}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endif %}
    {% endwith %}

    <!-- Selected Data Focus -->
    <div class="selected-data">
      <h3 class="h5 mb-3"><i class='bx bx-target'></i> Selected Historical Data Parameters</h3>
      <div class="row">
        <div class="col-md-3 mb-3">
          <div class="text-muted small">COURSE</div>
          <div class="fw-bold fs-5">{{ course }}</div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="text-muted small">SCHOOL YEAR</div>
          <div class="fw-bold fs-5">{{ year }}</div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="text-muted small">SEMESTER</div>
          <div class="fw-bold fs-5">{{ semester }}</div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="text-muted small">FOCUS</div>
          <div class="fw-bold fs-5 text-success">First-Year Enrollment</div>
        </div>
      </div>
    </div>

    <!-- First-Year Emphasis -->
    <div class="first-year-emphasis">
      <h3 class="h4 mb-2"><i class='bx bx-user-pin'></i> FIRST-YEAR ENROLLMENT FOCUS</h3>
      <p class="mb-0 fs-5">This analysis specifically highlights first-year student enrollment data for better admission planning</p>
    </div>

    <!-- Data Highlight -->
    <div class="data-highlight">
      <h2 class="h3 mb-2">First-Year Historical Enrollment: {{ first_year_enrollment }} students</h2>
      <p class="mb-0 opacity-90 fs-5">Based on actual first-year records from the uploaded dataset</p>
    </div>

    <!-- Year Level Breakdown -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="chart-container">
          <div class="chart-header">
            <h3 class="chart-title"><i class='bx bx-bar-chart-alt'></i> Historical Enrollment by Year Level</h3>
            <button class="download-btn" onclick="downloadChart('yearLevelChart', 'bed-year-levels-historical.png')">
              <i class='bx bx-download'></i> Download
            </button>
          </div>
          <canvas id="yearLevelChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Year Level Cards - Emphasizing First Year -->
    <div class="row">
      <div class="col-md-3">
        <div class="year-level-card year-level-emphasis emphasis-glow">
          <h5 class="h6 mb-3"><i class='bx bx-user-pin'></i> 1st Year</h5>
          <div class="stat-number" style="color: var(--primary);">{{ year_levels.first_year }}</div>
          <small class="text-muted">First-Year Students</small>
          <div class="mt-2">
            <small class="text-success fw-bold">
              {% if total_enrollment > 0 %}
                {{ ((year_levels.first_year / total_enrollment) * 100) | round(1) }}% of total
              {% else %}
                0% of total
              {% endif %}
            </small>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="year-level-card">
          <h5 class="h6 mb-3"><i class='bx bx-user-plus'></i> 2nd Year</h5>
          <div class="stat-number">{{ year_levels.second_year }}</div>
          <small class="text-muted">Historical Students</small>
        </div>
      </div>
      <div class="col-md-3">
        <div class="year-level-card">
          <h5 class="h6 mb-3"><i class='bx bx-user-voice'></i> 3rd Year</h5>
          <div class="stat-number">{{ year_levels.third_year }}</div>
          <small class="text-muted">Historical Students</small>
        </div>
      </div>
      <div class="col-md-3">
        <div class="year-level-card">
          <h5 class="h6 mb-3"><i class='bx bx-user-check'></i> 4th Year</h5>
          <div class="stat-number">{{ year_levels.fourth_year }}</div>
          <small class="text-muted">Historical Students</small>
        </div>
      </div>
    </div>

    <!-- First-Year Trend Chart -->
    <div class="chart-container mt-4">
      <div class="chart-header">
        <h3 class="chart-title"><i class='bx bx-trending-up'></i> First-Year Enrollment Trend</h3>
        <button class="download-btn" onclick="downloadChart('firstYearTrendChart', 'bed-first-year-trend.png')">
          <i class='bx bx-download'></i> Download
        </button>
      </div>
      <canvas id="firstYearTrendChart"></canvas>
    </div>

    <!-- Historical Trend -->
    <div class="chart-container mt-4">
      <div class="chart-header">
        <h3 class="chart-title"><i class='bx bx-trending-up'></i> Year Level Enrollment Trends</h3>
        <button class="download-btn" onclick="downloadChart('historicalChart', 'bed-historical-trend.png')">
          <i class='bx bx-download'></i> Download
        </button>
      </div>
      <canvas id="historicalChart"></canvas>
    </div>

    <!-- Pie Chart for Year Level Distribution -->
    <div class="chart-container">
      <div class="chart-header">
        <h3 class="chart-title"><i class='bx bx-pie-chart-alt'></i> Year Level Distribution</h3>
        <button class="download-btn" onclick="downloadChart('pieChart', 'bed-year-distribution.png')">
          <i class='bx bx-download'></i> Download
        </button>
      </div>
      <canvas id="pieChart"></canvas>
    </div>

    <!-- Data Summary Table -->
    <div class="chart-container">
      <div class="chart-header">
        <h3 class="chart-title"><i class='bx bx-table'></i> Historical Data Summary</h3>
      </div>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Parameter</th>
              <th>Value</th>
              <th>Details</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Selected Course</strong></td>
              <td>{{ course }}</td>
              <td>Business Education Department</td>
            </tr>
            <tr>
              <td><strong>School Year</strong></td>
              <td>{{ year }}</td>
              <td>Academic year period</td>
            </tr>
            <tr>
              <td><strong>Semester</strong></td>
              <td>{{ semester }} Semester</td>
              <td>Academic term</td>
            </tr>
            <tr style="background: linear-gradient(to right, rgba(32, 201, 151, 0.05), rgba(32, 201, 151, 0.1));">
              <td><strong>First-Year Historical Enrollment</strong></td>
              <td class="text-success fw-bold fs-5">{{ first_year_enrollment }} students</td>
              <td><strong>Primary focus for admission planning</strong></td>
            </tr>
            <tr>
              <td><strong>Total Historical Enrollment</strong></td>
              <td>{{ total_enrollment }} students</td>
              <td>All year levels combined</td>
            </tr>
            <tr>
              <td><strong>Year Level Distribution</strong></td>
              <td>
                1st: {{ year_levels.first_year }}, 
                2nd: {{ year_levels.second_year }},<br>
                3rd: {{ year_levels.third_year }}, 
                4th: {{ year_levels.fourth_year }}
              </td>
              <td>Per year level breakdown</td>
            </tr>
            <tr>
              <td><strong>Data Source</strong></td>
              <td>Historical Dataset</td>
              <td>Uploaded enrollment records</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="text-center mt-4 mb-5">
      <a href="{{ url_for('bed_filter_v2') }}" class="btn btn-primary me-3">
        <i class='bx bx-filter-alt'></i> New Historical Analysis
      </a>
      <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
        <i class='bx bx-home'></i> Go to Home
      </a>
    </div>
  </div>

<script>
// JSON data for the historical records
const historicalData = {
  course: "{{ course }}",
  year: "{{ year }}",
  semester: "{{ semester }}",
  first_year_enrollment: {{ first_year_enrollment }},
  total_enrollment: {{ total_enrollment }},
  year_levels: {{ year_levels | tojson }},
  historical_trend: {{ historical_trend | tojson }},
  dataset_info: {{ dataset_info | tojson }}
};

console.log('Historical Data:', historicalData);

// Year Level Chart
new Chart(document.getElementById('yearLevelChart'), {
  type: 'bar',
  data: {
    labels: ['1st Year', '2nd Year', '3rd Year', '4th Year'],
    datasets: [{
      label: 'Historical Enrollment by Year Level',
      data: [
        historicalData.year_levels.first_year,
        historicalData.year_levels.second_year,
        historicalData.year_levels.third_year,
        historicalData.year_levels.fourth_year
      ],
      backgroundColor: [
        '#20c997', '#4e73df', '#f6c23e', '#e74a3b'
      ],
      borderColor: [
        '#198754', '#224abe', '#dda20a', '#c0352d'
      ],
      borderWidth: 2
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      y: {
        beginAtZero: true,
        title: {
          display: true,
          text: 'Number of Students',
          font: {
            weight: 'bold'
          }
        },
        grid: {
          color: 'rgba(0,0,0,0.05)'
        }
      },
      x: {
        grid: {
          display: false
        }
      }
    },
    plugins: {
      legend: {
        display: false
      },
      title: {
        display: true,
        text: 'Historical Enrollment Distribution by Year Level',
        font: {
          size: 16,
          weight: 'bold'
        }
      }
    }
  }
});

// First-Year Trend Chart
new Chart(document.getElementById('firstYearTrendChart'), {
  type: 'line',
  data: {
    labels: historicalData.historical_trend.labels,
    datasets: [{
      label: 'First-Year Enrollment Trend',
      data: historicalData.historical_trend.first_year,
      borderColor: '#20c997',
      backgroundColor: 'rgba(32, 201, 151, 0.1)',
      fill: true,
      tension: 0.4,
      pointRadius: 6,
      pointBackgroundColor: '#20c997',
      pointBorderColor: '#fff',
      pointBorderWidth: 2,
      borderWidth: 3
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      y: {
        beginAtZero: true,
        title: {
          display: true,
          text: 'First-Year Students',
          font: {
            weight: 'bold'
          }
        },
        grid: {
          color: 'rgba(0,0,0,0.05)'
        }
      },
      x: {
        title: {
          display: true,
          text: 'Academic Period',
          font: {
            weight: 'bold'
          }
        },
        grid: {
          display: false
        }
      }
    },
    plugins: {
      title: {
        display: true,
        text: 'First-Year Enrollment Trend Over Time',
        font: {
          size: 16,
          weight: 'bold'
        }
      }
    }
  }
});

// Historical Trend Chart - Year Level Trends
const historicalChart = new Chart(document.getElementById('historicalChart'), {
    type: 'line',
    data: {
        labels: historicalData.historical_trend.labels,
        datasets: [
            {
                label: '1st Year',
                data: historicalData.historical_trend.first_year,
                borderColor: '#20c997',
                backgroundColor: 'rgba(32, 201, 151, 0.1)',
                fill: false,
                tension: 0.4,
                pointRadius: 5,
                pointBackgroundColor: '#20c997',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                borderWidth: 3
            },
            {
                label: '2nd Year',
                data: historicalData.historical_trend.second_year,
                borderColor: '#4e73df',
                backgroundColor: 'rgba(78, 115, 223, 0.1)',
                fill: false,
                tension: 0.4,
                pointRadius: 4,
                pointBackgroundColor: '#4e73df',
                borderWidth: 2
            },
            {
                label: '3rd Year',
                data: historicalData.historical_trend.third_year,
                borderColor: '#f6c23e',
                backgroundColor: 'rgba(246, 194, 62, 0.1)',
                fill: false,
                tension: 0.4,
                pointRadius: 4,
                pointBackgroundColor: '#f6c23e',
                borderWidth: 2
            },
            {
                label: '4th Year',
                data: historicalData.historical_trend.fourth_year,
                borderColor: '#e74a3b',
                backgroundColor: 'rgba(231, 74, 59, 0.1)',
                fill: false,
                tension: 0.4,
                pointRadius: 4,
                pointBackgroundColor: '#e74a3b',
                borderWidth: 2
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true,
                title: {
                    display: true,
                    text: 'Number of Students',
                    font: {
                      weight: 'bold'
                    }
                },
                grid: {
                  color: 'rgba(0,0,0,0.05)'
                }
            },
            x: {
                title: {
                    display: true,
                    text: 'Academic Period',
                    font: {
                      weight: 'bold'
                    }
                },
                grid: {
                  display: false
                }
            }
        },
        plugins: {
            title: {
                display: true,
                text: 'Year Level Enrollment Trends Over Time',
                font: {
                  size: 16,
                  weight: 'bold'
                }
            },
            tooltip: {
                callbacks: {
                    label: function(context) {
                        return `${context.dataset.label}: ${context.parsed.y} students`;
                    }
                }
            }
        }
    }
});

// Pie Chart for Year Level Distribution
new Chart(document.getElementById('pieChart'), {
  type: 'pie',
  data: {
    labels: ['1st Year', '2nd Year', '3rd Year', '4th Year'],
    datasets: [{
      data: [
        historicalData.year_levels.first_year,
        historicalData.year_levels.second_year,
        historicalData.year_levels.third_year,
        historicalData.year_levels.fourth_year
      ],
      backgroundColor: [
        '#20c997', '#4e73df', '#f6c23e', '#e74a3b'
      ],
      borderColor: [
        '#198754', '#224abe', '#dda20a', '#c0352d'
      ],
      borderWidth: 2
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        position: 'bottom',
        labels: {
          font: {
            size: 12,
            weight: 'bold'
          }
        }
      },
      title: {
        display: true,
        text: 'Year Level Distribution Percentage',
        font: {
          size: 16,
          weight: 'bold'
        }
      },
      tooltip: {
        callbacks: {
          label: function(context) {
            const total = context.dataset.data.reduce((a, b) => a + b, 0);
            const percentage = ((context.parsed / total) * 100).toFixed(1);
            return `${context.label}: ${context.parsed} students (${percentage}%)`;
          }
        }
      }
    }
  }
});

function downloadChart(canvasId, filename) {
  const canvas = document.getElementById(canvasId);
  const link = document.createElement('a');
  link.download = filename;
  link.href = canvas.toDataURL('image/png');
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  
  // Show download notification
  const notification = document.createElement('div');
  notification.className = 'alert alert-success';
  notification.innerHTML = '<i class="bx bx-check"></i> Chart downloaded successfully!';
  document.body.appendChild(notification);
  setTimeout(() => notification.remove(), 3000);
}
</script>

<!-- Add Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>